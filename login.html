<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The Base - Login</title>
    <style>
      :root {
        --text: #f2f3f8;
        --muted: #b8b3c9;
        --line: #634699;
        --line-2: #7454ad;
        --btn-line: #7f5ec0;
        --btn-active: #aa84ff;
      }
      * { box-sizing: border-box; }
      body {
        margin: 0;
        font-family: "Avenir Next", "Segoe UI", sans-serif;
        color: var(--text);
        background:
          radial-gradient(circle at 12% 8%, #7e5acf34 0%, transparent 42%),
          radial-gradient(circle at 90% 12%, #ab85ff2e 0%, transparent 34%),
          linear-gradient(160deg, #14121f, #1d1a2b 62%, #12101b);
      }
      .shell { max-width: 1020px; margin: 0 auto; padding: 0.7rem; }
      .header {
        border: 1px solid var(--line);
        border-radius: 24px;
        padding: 0.8rem 1.1rem;
        background: linear-gradient(180deg, #2f2744, #241f34);
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        box-shadow: 0 10px 25px #00000040;
      }
      .brand { display:flex; align-items:center; gap:0.75rem; }
      .brand-logo {
        width: 64px; height: 64px; object-fit: cover; border-radius: 50%;
        border: 2px solid var(--line); box-shadow: 0 6px 16px #00000055; display:block;
      }
      .brand-dot { width: 42px; height:42px; border-radius:999px; background:linear-gradient(150deg,#ff2d72,#ff5b5b); display:none; place-items:center; font-weight:800; font-size:1.3rem; }
      .brand-wordmark { font-weight: 700; letter-spacing: 0.08em; }
      .brand p { margin: 0.18rem 0 0; color: var(--muted); font-size: 0.8rem; }
      .header a { color: #d7c7ff; text-decoration: none; }
      .main {
        margin-top: 0.9rem;
        border: 1px solid var(--line);
        border-radius: 22px;
        padding: 1rem;
        background: linear-gradient(180deg, #2a243a, #201c2d);
      }
      .grid { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:0.8rem; }
      .card { border:1px solid var(--line-2); border-radius:14px; padding:0.8rem; background: linear-gradient(170deg,#322a46,#262038); }
      .card h2 { margin:0 0 0.6rem; font-size:1.05rem; }
      label { display:block; font-size:0.8rem; color:var(--muted); margin-bottom:0.2rem; }
      input, select {
        width:100%;
        background:#171924;
        border:1px solid var(--line-2);
        color:var(--text);
        border-radius:8px;
        padding:0.48rem;
        font:inherit;
      }
      .row { margin-bottom:0.5rem; }
      button {
        border:1px solid var(--btn-line);
        border-radius:9px;
        background: linear-gradient(180deg, #3a3152, #2a243c);
        color:var(--text);
        padding:0.5rem 0.75rem;
        cursor:pointer;
        font:inherit;
      }
      button.primary {
        border-color: var(--btn-active);
        background: linear-gradient(180deg, color-mix(in srgb, var(--btn-active) 38%, #323846 62%), color-mix(in srgb, var(--btn-line) 58%, #262b36 42%));
      }
      .muted { color:var(--muted); }
      .status { min-height:1.1rem; margin-top:0.4rem; font-size:0.86rem; }
      .status.bad { color:#ff9eb0; }
      .status.ok { color:#b8f0d2; }
      @media (max-width: 860px) { .grid { grid-template-columns: 1fr; } }
    </style>
  </head>
  <body>
    <div class="shell">
      <header class="header">
        <div class="brand">
          <img id="brandLogo" class="brand-logo" src="assets/base-logo.png" alt="BASE Logo" />
          <div class="brand-dot" id="brandFallback">B</div>
          <div>
            <div class="brand-wordmark">THE BASE</div>
            <p>Secure access for project collaboration.</p>
          </div>
        </div>
        <a href="projects.html">Back To Projects</a>
      </header>

      <main class="main">
        <div class="grid">
          <section class="card">
            <h2>Sign In</h2>
            <div class="row"><label>Email</label><input id="signinEmail" type="email" autocomplete="email" /></div>
            <div class="row"><label>Password</label><input id="signinPassword" type="password" autocomplete="current-password" /></div>
            <button class="primary" id="signinBtn">Sign In</button>
            <div class="status" id="signinStatus"></div>
          </section>

          <section class="card">
            <h2>Create Account</h2>
            <div class="row"><label>Name</label><input id="signupName" type="text" autocomplete="name" /></div>
            <div class="row"><label>Department</label>
              <select id="signupDepartment">
                <option>Video</option>
                <option>Audio</option>
                <option>Lighting</option>
                <option>General</option>
                <option>Operations</option>
                <option>Warehouse</option>
              </select>
            </div>
            <div class="row"><label>Email</label><input id="signupEmail" type="email" autocomplete="email" /></div>
            <div class="row"><label>Password</label><input id="signupPassword" type="password" autocomplete="new-password" /></div>
            <button class="primary" id="signupBtn">Create Account</button>
            <div class="status" id="signupStatus"></div>
            <div class="muted" style="margin-top:0.5rem;font-size:0.82rem;">If email confirmation is enabled in Supabase, verify your email then sign in.</div>
          </section>
        </div>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="data/auth-config.js"></script>
    <script src="data/auth-projects.js"></script>
    <script>
      (function () {
        const logo = document.getElementById("brandLogo");
        const fallback = document.getElementById("brandFallback");
        if (logo && fallback) {
          logo.addEventListener("error", () => {
            logo.style.display = "none";
            fallback.style.display = "grid";
          });
        }

        const nextUrl = new URLSearchParams(window.location.search).get("next") || "projects.html";
        const setStatus = (id, msg, ok) => {
          const el = document.getElementById(id);
          if (!el) return;
          el.textContent = String(msg || "");
          el.className = `status ${ok ? "ok" : "bad"}`;
        };

        async function bootstrap() {
          if (!window.TheBaseCloud || !TheBaseCloud.isConfigured()) return;
          await TheBaseCloud.init();
          const modeText = TheBaseCloud.isCloudMode && TheBaseCloud.isCloudMode()
            ? "Cloud mode active."
            : "Local mode active (browser storage).";
          setStatus("signinStatus", modeText, true);
          const user = await TheBaseCloud.getUser();
          if (user) {
            window.location.href = nextUrl;
            return;
          }
        }

        document.getElementById("signinBtn")?.addEventListener("click", async () => {
          try {
            setStatus("signinStatus", "", false);
            const email = document.getElementById("signinEmail")?.value || "";
            const password = document.getElementById("signinPassword")?.value || "";
            await TheBaseCloud.signIn(email, password);
            setStatus("signinStatus", "Signed in. Redirecting...", true);
            window.location.href = nextUrl;
          } catch (err) {
            setStatus("signinStatus", err?.message || "Sign in failed", false);
          }
        });

        document.getElementById("signupBtn")?.addEventListener("click", async () => {
          try {
            setStatus("signupStatus", "", false);
            const name = document.getElementById("signupName")?.value || "";
            const department = document.getElementById("signupDepartment")?.value || "General";
            const email = document.getElementById("signupEmail")?.value || "";
            const password = document.getElementById("signupPassword")?.value || "";
            await TheBaseCloud.signUp(email, password, name, department);
            setStatus("signupStatus", "Account created. Check your email if confirmation is enabled.", true);
          } catch (err) {
            setStatus("signupStatus", err?.message || "Sign up failed", false);
          }
        });

        bootstrap();
      })();
    </script>
  </body>
</html>
